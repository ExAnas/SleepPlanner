<script>
  // ===== Helpers =====
  let cycleMin = 90;
  const todayBadge = document.getElementById('todayBadge');
  const tzBadge = document.getElementById('tzBadge');
  const subtitleEl = document.getElementById('subtitle');
  const cycleBadge = document.getElementById('cycleBadge');
  const footerCycle = document.getElementById('footerCycle');
  const wakeBadge = document.getElementById('wakeBadge');

  function pad(n){return String(n).padStart(2,'0')}
  function fmt(date){ return pad(date.getHours())+":"+pad(date.getMinutes()) }
  function addMin(date, m){ return new Date(date.getTime() + m*60000) }
  function subMin(date, m){ return new Date(date.getTime() - m*60000) }
  function makeTodayAt(hhmm){
    const [h,m] = (hhmm||'').split(':').map(Number);
    const now = new Date();
    return new Date(now.getFullYear(), now.getMonth(), now.getDate(), h||0, m||0, 0);
  }
  function humanSpan(start, end){
    const startD = new Date(start), endD = new Date(end);
    let startTag = '', endTag = '';
    const today = new Date(); today.setHours(0,0,0,0);
    const sBase = new Date(startD); sBase.setHours(0,0,0,0);
    const eBase = new Date(endD);   eBase.setHours(0,0,0,0);
    const diffS = Math.round